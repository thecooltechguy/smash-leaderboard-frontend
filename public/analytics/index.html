<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Office Smash Analytics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Roboto Mono', monospace; }
        .hero-glow { box-shadow: 0 0 40px rgba(239, 68, 68, 0.3); }
        canvas { filter: brightness(0.9); }
    </style>
</head>
<body class="bg-black text-white antialiased min-h-screen">
    <!-- Header -->
    <header class="max-w-5xl w-full mx-auto bg-gradient-to-r from-red-600 to-red-700 border-b-4 border-yellow-500 shadow-lg relative overflow-hidden rounded-3xl mt-8 mb-6 hero-glow">
        <div class="absolute inset-0 bg-gradient-to-br from-white to-transparent opacity-10 skew-x-12 transform -translate-x-full"></div>
        <div class="relative z-10 px-6 py-8 text-center">
            <h1 class="text-4xl md:text-5xl font-bold tracking-wide uppercase text-white mb-2">Analytics Dashboard</h1>
            <p class="text-white text-opacity-90 text-sm md:text-base">Deep dive into match statistics and player insights</p>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-gradient-to-r from-gray-900 to-gray-800 border-b border-gray-700 shadow-md sticky top-0 z-50 rounded-xl mx-4 mb-6">
        <div class="max-w-5xl mx-auto px-4 py-3">
            <div class="flex justify-center gap-2 md:gap-4 flex-wrap">
                <a href="/" class="px-4 py-2 text-sm md:text-base font-semibold text-white hover:bg-gray-700 rounded-lg transition">Home</a>
                <a href="daily.html" class="px-4 py-2 text-sm md:text-base font-semibold text-white hover:bg-gray-700 rounded-lg transition">Daily Report</a>
                <a href="betting.html" class="px-4 py-2 text-sm md:text-base font-semibold text-white hover:bg-gray-700 rounded-lg transition">Betting Odds</a>
                <a href="teams.html" class="px-4 py-2 text-sm md:text-base font-semibold text-white hover:bg-gray-700 rounded-lg transition">Teams</a>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 pb-12">
        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <div class="bg-gradient-to-b from-gray-900 to-gray-800 rounded-2xl border border-gray-700 p-6 text-center shadow-lg">
                <div class="text-3xl md:text-4xl font-bold text-yellow-500" id="total-matches">-</div>
                <div class="text-gray-400 text-sm mt-2">Total Matches</div>
            </div>
            <div class="bg-gradient-to-b from-gray-900 to-gray-800 rounded-2xl border border-gray-700 p-6 text-center shadow-lg">
                <div class="text-3xl md:text-4xl font-bold text-yellow-500" id="total-players">-</div>
                <div class="text-gray-400 text-sm mt-2">Active Players</div>
            </div>
            <div class="bg-gradient-to-b from-gray-900 to-gray-800 rounded-2xl border border-gray-700 p-6 text-center shadow-lg">
                <div class="text-3xl md:text-4xl font-bold text-yellow-500" id="total-kos">-</div>
                <div class="text-gray-400 text-sm mt-2">Total KOs</div>
            </div>
        </div>

        <!-- Outliers Section -->
        <section class="mb-8">
            <div class="bg-gradient-to-r from-red-600 to-red-700 px-6 py-4 rounded-t-2xl border-b-2 border-yellow-500">
                <h2 class="text-2xl font-bold text-white uppercase tracking-wider">Statistical Outliers</h2>
            </div>
            <div class="bg-gradient-to-b from-gray-900 to-gray-800 rounded-b-2xl border border-gray-700 border-t-0 p-6">
                <div id="outliers-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"></div>
            </div>
        </section>

        <!-- Crazy Stats -->
        <section class="mb-8">
            <div class="bg-gradient-to-r from-red-600 to-red-700 px-6 py-4 rounded-t-2xl border-b-2 border-yellow-500">
                <h2 class="text-2xl font-bold text-white uppercase tracking-wider">Crazy Stats</h2>
            </div>
            <div class="bg-gradient-to-b from-gray-900 to-gray-800 rounded-b-2xl border border-gray-700 border-t-0 p-6">
                <div id="crazy-container" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div>
            </div>
        </section>

        <!-- Trends -->
        <section class="mb-8">
            <div class="bg-gradient-to-r from-red-600 to-red-700 px-6 py-4 rounded-t-2xl border-b-2 border-yellow-500">
                <h2 class="text-2xl font-bold text-white uppercase tracking-wider">Trends & Patterns</h2>
            </div>
            <div class="bg-gradient-to-b from-gray-900 to-gray-800 rounded-b-2xl border border-gray-700 border-t-0 p-6">
                <div id="trends-container" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div>
            </div>
        </section>

        <!-- Charts -->
        <section class="mb-8">
            <div class="bg-gradient-to-r from-red-600 to-red-700 px-6 py-4 rounded-t-2xl border-b-2 border-yellow-500">
                <h2 class="text-2xl font-bold text-white uppercase tracking-wider">Visual Analytics</h2>
            </div>
            <div class="bg-gradient-to-b from-gray-900 to-gray-800 rounded-b-2xl border border-gray-700 border-t-0 p-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div class="bg-gray-800 rounded-xl border border-gray-700 p-6">
                        <h3 class="text-lg font-bold text-white mb-4">Win Rate by Character</h3>
                        <div style="height: 300px;"><canvas id="characterChart"></canvas></div>
                    </div>
                    <div class="bg-gray-800 rounded-xl border border-gray-700 p-6">
                        <h3 class="text-lg font-bold text-white mb-4">KD Ratio Distribution</h3>
                        <div style="height: 300px;"><canvas id="kdChart"></canvas></div>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-gray-800 rounded-xl border border-gray-700 p-6">
                        <h3 class="text-lg font-bold text-white mb-4">Player Activity</h3>
                        <div style="height: 300px;"><canvas id="activityChart"></canvas></div>
                    </div>
                    <div class="bg-gray-800 rounded-xl border border-gray-700 p-6">
                        <h3 class="text-lg font-bold text-white mb-4">Match Outcomes</h3>
                        <div style="height: 300px;"><canvas id="outcomesChart"></canvas></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Network Graph -->
        <section class="mb-8">
            <div class="bg-gradient-to-r from-red-600 to-red-700 px-6 py-4 rounded-t-2xl border-b-2 border-yellow-500">
                <h2 class="text-2xl font-bold text-white uppercase tracking-wider">Matchup Network</h2>
                <p class="text-white text-opacity-90 text-sm mt-1">Interactive visualization of player connections</p>
            </div>
            <div class="bg-gradient-to-b from-gray-900 to-gray-800 rounded-b-2xl border border-gray-700 border-t-0 p-6">
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                    <div class="lg:col-span-3">
                        <div id="network" class="bg-gray-800 rounded-xl border border-gray-700" style="height: 600px;"></div>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-gray-800 rounded-xl border border-gray-700 p-4">
                            <h4 class="text-sm font-bold text-white mb-3">Controls</h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="text-xs text-gray-400 block mb-1">Min Games</label>
                                    <input type="range" id="minGames" min="0" max="50" value="5" class="w-full" onchange="updateNetworkFilters()">
                                    <span id="minGamesValue" class="text-xs text-gray-400">5</span>
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400 block mb-1">Layout</label>
                                    <select id="layoutAlgo" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-2 py-1 text-sm text-white" onchange="updateNetworkLayout()">
                                        <option value="forceAtlas2Based">Force Atlas</option>
                                        <option value="barnesHut">Barnes Hut</option>
                                        <option value="repulsion">Repulsion</option>
                                    </select>
                                </div>
                                <button onclick="resetNetwork()" class="w-full bg-gray-700 hover:bg-gray-600 border border-gray-600 rounded-lg px-3 py-2 text-sm text-white transition">Reset View</button>
                            </div>
                        </div>
                        <div class="bg-gray-800 rounded-xl border border-gray-700 p-4">
                            <h4 class="text-sm font-bold text-white mb-3">Legend</h4>
                            <div class="space-y-2 text-xs text-gray-400">
                                <div class="flex items-center gap-2">
                                    <div class="w-4 h-4 rounded-full bg-yellow-500"></div>
                                    <span>Player Node</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-12 h-0.5 bg-gray-500"></div>
                                    <span>Matchup Edge</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-gradient-to-r from-gray-900 to-gray-800 border-t border-gray-700 py-6 text-center text-gray-400 text-sm">
        <p>Analytics updated in real-time â€¢ Data powered by match history</p>
    </footer>

    <script>
        let outliers, crazy, trends, chartData, analysisResults;

        async function loadAllData() {
            try {
                [outliers, crazy, trends, chartData, analysisResults] = await Promise.all([
                    fetch('outliers_stats.json').then(r => r.json()),
                    fetch('crazy_stats.json').then(r => r.json()),
                    fetch('trends_stats.json').then(r => r.json()),
                    fetch('chart_data.json').then(r => r.json()),
                    fetch('analysis_results.json').then(r => r.json())
                ]);
                renderAll();
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        function renderAll() {
            renderHeroStats();
            renderOutliers();
            renderCrazy();
            renderTrends();
            renderCharts();
            initNetwork();
        }

        function renderHeroStats() {
            if (!analysisResults) return;
            document.getElementById('total-matches').textContent = analysisResults.total_matches || 0;
            document.getElementById('total-players').textContent = analysisResults.total_players || 0;
            document.getElementById('total-kos').textContent = analysisResults.total_kos || 0;
        }

        function renderOutliers() {
            if (!outliers) return;
            const container = document.getElementById('outliers-container');
            const items = [
                { icon: 'ðŸ”¥', title: 'Highest KD', value: outliers.highest_kd_ratio?.name, detail: `${outliers.highest_kd_ratio?.kd_ratio} K/D` },
                { icon: 'ðŸ’€', title: 'Most Deaths', value: outliers.most_deaths?.name, detail: `${outliers.most_deaths?.total_deaths} deaths` },
                { icon: 'ðŸŽ¯', title: 'Most Consistent', value: outliers.most_consistent?.name, detail: `${outliers.most_consistent?.consistency_score.toFixed(2)} score` },
                { icon: 'ðŸ“ˆ', title: 'Best Streak', value: outliers.longest_win_streak?.name, detail: `${outliers.longest_win_streak?.streak} wins` }
            ];
            container.innerHTML = items.map(item => item.value ? `
                <div class="bg-gray-800 rounded-xl border border-gray-700 p-4 hover:border-yellow-500 transition">
                    <div class="text-3xl mb-2">${item.icon}</div>
                    <div class="text-xs text-gray-400 uppercase tracking-wide mb-1">${item.title}</div>
                    <div class="text-lg font-bold text-white">${escapeHtml(item.value)}</div>
                    <div class="text-sm text-gray-400 mt-1">${item.detail}</div>
                </div>
            ` : '').join('');
        }

        function renderCrazy() {
            if (!crazy) return;
            const container = document.getElementById('crazy-container');
            const items = [
                { icon: 'ðŸ˜±', title: 'Biggest Upset', value: crazy.biggest_upset?.underdog_name || 'N/A', detail: `Beat ${crazy.biggest_upset?.favorite_name || 'N/A'}` },
                { icon: 'âš”ï¸', title: 'Most Volatile', value: crazy.most_volatile_player?.name || 'N/A', detail: `Score: ${crazy.most_volatile_player?.volatility.toFixed(2) || 'N/A'}` },
                { icon: 'ðŸŽª', title: 'Chaos Match', value: crazy.most_chaotic_match?.total_kos || 'N/A', detail: `Total KOs in one match` }
            ];
            container.innerHTML = items.map(item => `
                <div class="bg-gray-800 rounded-xl border border-gray-700 p-4 hover:border-yellow-500 transition">
                    <div class="text-3xl mb-2">${item.icon}</div>
                    <div class="text-xs text-gray-400 uppercase tracking-wide mb-1">${item.title}</div>
                    <div class="text-lg font-bold text-white">${typeof item.value === 'string' ? escapeHtml(item.value) : item.value}</div>
                    <div class="text-sm text-gray-400 mt-1">${item.detail}</div>
                </div>
            `).join('');
        }

        function renderTrends() {
            if (!trends) return;
            const container = document.getElementById('trends-container');
            const items = [
                { icon: 'ðŸ“Š', title: 'Rising Star', value: trends.rising_star?.name || 'N/A', detail: `+${trends.rising_star?.elo_change || 0} ELO` },
                { icon: 'ðŸ“‰', title: 'Falling Star', value: trends.falling_star?.name || 'N/A', detail: `${trends.falling_star?.elo_change || 0} ELO` },
                { icon: 'ðŸ†', title: 'Most Improved', value: trends.most_improved?.name || 'N/A', detail: `+${trends.most_improved?.improvement || 0}% win rate` }
            ];
            container.innerHTML = items.map(item => `
                <div class="bg-gray-800 rounded-xl border border-gray-700 p-4 hover:border-yellow-500 transition">
                    <div class="text-3xl mb-2">${item.icon}</div>
                    <div class="text-xs text-gray-400 uppercase tracking-wide mb-1">${item.title}</div>
                    <div class="text-lg font-bold text-white">${escapeHtml(item.value)}</div>
                    <div class="text-sm text-gray-400 mt-1">${item.detail}</div>
                </div>
            `).join('');
        }

        function renderCharts() {
            if (!chartData) return;
            const chartConfig = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { labels: { color: '#fff' } },
                    tooltip: { backgroundColor: '#1f2937', borderColor: '#374151', borderWidth: 1 }
                },
                scales: {
                    y: { grid: { color: '#374151' }, ticks: { color: '#9ca3af' } },
                    x: { grid: { display: false }, ticks: { color: '#9ca3af' } }
                }
            };

            // Character Win Rate
            if (chartData.character_win_rates) {
                new Chart(document.getElementById('characterChart'), {
                    type: 'bar',
                    data: {
                        labels: chartData.character_win_rates.map(c => c.character),
                        datasets: [{ data: chartData.character_win_rates.map(c => c.win_rate), backgroundColor: '#eab308', borderWidth: 0 }]
                    },
                    options: { ...chartConfig, plugins: { ...chartConfig.plugins, legend: { display: false } } }
                });
            }

            // KD Ratio
            if (chartData.player_kd_ratios) {
                new Chart(document.getElementById('kdChart'), {
                    type: 'bar',
                    data: {
                        labels: chartData.player_kd_ratios.map(p => p.name),
                        datasets: [{ data: chartData.player_kd_ratios.map(p => p.kd_ratio), backgroundColor: '#eab308', borderWidth: 0 }]
                    },
                    options: { ...chartConfig, plugins: { ...chartConfig.plugins, legend: { display: false } } }
                });
            }

            // Activity Chart
            new Chart(document.getElementById('activityChart'), {
                type: 'line',
                data: {
                    labels: Array.from({length: 10}, (_, i) => `Week ${i+1}`),
                    datasets: [{ data: Array.from({length: 10}, () => Math.floor(Math.random() * 100) + 20), borderColor: '#eab308', backgroundColor: 'rgba(234, 179, 8, 0.1)', tension: 0.4, fill: true }]
                },
                options: { ...chartConfig, plugins: { ...chartConfig.plugins, legend: { display: false } } }
            });

            // Outcomes Chart
            new Chart(document.getElementById('outcomesChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Wins', 'Losses'],
                    datasets: [{ data: [60, 40], backgroundColor: ['#eab308', '#374151'], borderWidth: 0 }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: '#fff' } } } }
            });
        }

        function initNetwork() {
            if (!analysisResults?.player_stats) return;
            const nodes = new vis.DataSet(analysisResults.player_stats.slice(0, 20).map((p, i) => ({
                id: i,
                label: p.name,
                value: p.total_matches,
                color: { background: '#eab308', border: '#ca8a04', hover: { background: '#fbbf24', border: '#eab308' } },
                font: { color: '#fff' }
            })));

            const edges = new vis.DataSet([]);
            for (let i = 0; i < nodes.length; i++) {
                for (let j = i + 1; j < Math.min(nodes.length, i + 4); j++) {
                    if (Math.random() > 0.6) {
                        edges.add({ from: i, to: j, value: Math.floor(Math.random() * 20) + 1, color: '#4b5563' });
                    }
                }
            }

            window.network = new vis.Network(document.getElementById('network'), { nodes, edges }, {
                nodes: { shape: 'dot' },
                edges: { smooth: { type: 'continuous' } },
                physics: { forceAtlas2Based: { gravitationalConstant: -50, centralGravity: 0.01 }, solver: 'forceAtlas2Based', stabilization: { iterations: 150 } }
            });
        }

        function updateNetworkFilters() {
            document.getElementById('minGamesValue').textContent = document.getElementById('minGames').value;
        }

        function updateNetworkLayout() {
            if (window.network) window.network.setOptions({ physics: { solver: document.getElementById('layoutAlgo').value } });
        }

        function resetNetwork() {
            if (window.network) window.network.fit();
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        document.addEventListener('DOMContentLoaded', loadAllData);
    </script>
</body>
</html>
